---
layout: post
title:  "ICFPC 2023: Music Concert"
---


This year task was about placing band musicians on the stage to maximize the concert attendees score based on their music peference.

## Final Results

There are no final scores yet, but we finished at 19th place in the frozen leaderboard (our final score was actually `121,325,153,271`, so we won't get higher than 18th place):

<img src="img/icfpc-2023/leaderboard.png" style="width: 100%;"/>


## Overall Impression

Overall the contest was really good! Just a few minor observations:

- The task itself felt a bit repeatative - similar to 2 previous years, this was a static problem optimization, no VMs, programming languages or other surprises involved. I understand that it's harder to do different style of problem than static one, but I am concerned that ICFPC now converged into this state.
- The description changes were fairly small and didn't change the problem much. Pillars were predictable from the initial input, closeness factor addition was actually okay, and the addition of volume was a few lines change (not clear why range [0; 10] was chosen, while all the final answers would be 0 or 10)

## Members

Similar to last year, we had the following members:

- Alex P.
- Dmitry P.
- Oleg G.
- Victor K.
- Vitaly A.

## Languages used

- C++ (solver)
- Python (scripts)
- Javascript (UI)


## Solution

We had 2 solutions, that performed pretty similar on a full subset of problems.

### Border Solver

- Do a packed hexagonal grid around the border with N layers. (`N = 3` for first batch and manually tune `N >= 5` for the second batch where closeness matters)
- Add Fake musicians to the list (they always score 0) so that total musicians match the total number of spots in layers.
- Use Hungarian algortithm to find optimal assignment of musicians to the spots
- Use greedy swapping algorithm to optimize for closeness
- Here are examples of typical arrangmenets it creates:

<img src="img/icfpc-2023/b1.png" style="width: 100%;"/>
<img src="img/icfpc-2023/b2.png" style="width: 80%;"/>
<img src="img/icfpc-2023/b3.png" style="width: 80%;"/>

### Stohastic Greedy Solver

- Find the position of musicians one by one using local gradient descent (no visibility into account, but don't allow overlaps)
- There are certain rules and heuristics where next musician could be placed
- Finally run Hungarian and Swapping fine-tuning similar to previous approach
- Here are examples of typical arrangmenets it creates:

<img src="img/icfpc-2023/g1.png" style="width: 100%;"/>
<img src="img/icfpc-2023/g2.png" style="width: 100%;"/>
<img src="img/icfpc-2023/g3.png" style="width: 80%;"/>
<img src="img/icfpc-2023/g4.png" style="width: 80%;"/>

### UI

We also built a convenient UI to analyze the problems:

<img src="img/icfpc-2023/ui.png" style="width: 100%;"/>

## Misc

We built a slack bot that was posting our score and position when things has changed. Here is the final run of it before the leaderboard got frozen:

<img src="img/icfpc-2023/logs.png" style="width: 100%;"/>

Then we switched to different API to show only our score:

<img src="img/icfpc-2023/logs2.png" style="width: 100%;"/>

We also had some analytics built-in into UI to see force fields:

<img src="img/icfpc-2023/gradient.png" style="width: 100%;"/>

Some teams spent quite a few money on AWS bill:

<img src="img/icfpc-2023/aws.png" style="width: 100%;"/>

Was cool to see different visualizations from other teams:

<img src="img/icfpc-2023/discord1.png" style="width: 100%;"/>
<img src="img/icfpc-2023/discord2.png" style="width: 100%;"/>
<img src="img/icfpc-2023/discord3.png" style="width: 100%;"/>
<img src="img/icfpc-2023/discord4.png" style="width: 100%;"/>
